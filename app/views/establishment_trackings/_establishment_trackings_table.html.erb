<% if @paginated_establishment_trackings.any? %>
  <h4>Résultats de la recherche (<%= @paginated_establishment_trackings.total_count %>)</h4>
<% else %>
  <p>Aucun accompagnement trouvé pour cette combinaison de filtres.</p>
<% end %>

<%= link_to establishment_trackings_path(format: :xlsx, q: params[:q]&.permit!), class: 'fr-link--download fr-link', download: "true" do %>
  Télécharger les <%= @paginated_establishment_trackings.total_count %> accompagnements retrouvés
  <span class="fr-link__detail">XLS – 61,88 ko</span>
<% end %>

<div class="fr-table" id="table-md-component">
  <div class="fr-table__wrapper">
    <div class="fr-table__container">
      <div class="fr-table__content">
        <table id="table-md">
          <% if @paginated_establishment_trackings.any? %>
            <thead>
              <tr>
                <th>Raison sociale</th>
                <th>Siret</th>
                <th>Statut</th>
                <th><%= sort_link @q, :start_date, "Date de démarrage" %></th>
                <th>Assignés</th>
                <th>Étiquettes</th>
                <th colspan="2">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @paginated_establishment_trackings.each do |tracking| %>
                <tr>
                  <td><%= tracking.establishment.raison_sociale %></td>
                  <td><%= tracking.establishment.siret %></td>
                  <td><%= content_tag :p, tracking.aasm.human_state, class: badge_class_for(tracking.aasm.human_state) %></td>
                  <td><%= tracking.start_date.present? ? l(tracking.start_date, format: :default) : '-' %></td>
                  <td><%= tracking.referents.map(&:full_name).join(', ') %></td>
                  <td><%= tracking.tracking_labels.map(&:name).join(', ') %></td>
                  <td>
                    <%= link_to 'Consulter', [tracking.establishment, tracking], class: 'fr-link fr-icon-arrow-right-line fr-link--icon-right' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          <% end %>
        </table>

      </div>
    </div>
  </div>
</div>
<%= paginate @paginated_establishment_trackings %>

